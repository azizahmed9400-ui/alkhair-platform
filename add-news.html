<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إضافة خبر أو قصة نجاح | منصة الخير</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <nav class="main-nav">
            <div class="logo">
                <a href="index.html">منصة الخير</a>
            </div>
            <button class="menu-toggle" id="menu-toggle-btn"><i class="fas fa-bars"></i></button>
            <ul id="main-menu-list">
                <li><a href="admin.html">لوحة التحكم</a></li>
                <li><a href="news.html">معاينة الأخبار</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="page-hero" style="padding: 40px 20px; margin-bottom: 30px;">
            <h1>انشر الأمل</h1>
            <p>شارك العالم قصص النجاح وأخبار مشاريعنا أولاً بأول.</p>
        </div>

        <section class="section-container" style="max-width: 800px;">
            <form id="add-news-form" class="form-container" style="background: white; padding: 40px; border-radius: 15px; box-shadow: var(--shadow-md);">
                
                <h2 style="text-align: center; margin-bottom: 30px;">بيانات المنشور الجديد</h2>

                <div class="form-group">
                    <label>عنوان الخبر / القصة</label>
                    <input type="text" id="news-title" placeholder="مثال: قصة الطفلة أمل وعودة الحياة للحي..." required>
                </div>

                <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>التصنيف</label>
                        <select id="news-category">
                            <option value="story">قصة نجاح (Story)</option>
                            <option value="news">خبر عاجل (News)</option>
                            <option value="report">تقرير إنجاز</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>الكاتب / المصدر</label>
                        <input type="text" id="news-author" placeholder="مثال: اللجنة الإعلامية" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>صورة الخبر (رابط URL)</label>
                    <input type="url" id="news-image" placeholder="https://example.com/image.jpg" required>
                </div>

                <div class="form-group">
                    <label>ملخص قصير (يظهر في البطاقة الخارجية)</label>
                    <textarea id="news-summary" rows="2" maxlength="150" placeholder="اكتب ملخصاً تشويقياً لا يتجاوز 150 حرفاً..." required></textarea>
                </div>

                <div class="form-group">
                    <label>تفاصيل الخبر كاملة</label>
                    <textarea id="news-content" rows="8" placeholder="اكتب تفاصيل القصة كاملة هنا..." required></textarea>
                </div>

                <button type="submit" class="button primary" style="width: 100%; font-size: 1.1em; padding: 12px;">
                    <i class="fas fa-paper-plane"></i> نشر الخبر الآن
                </button>

            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 منصة الخير. جميع الحقوق محفوظة.</p>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/message-box.js"></script>
    <script src="js/script.js"></script>
    
    <script>
        /* منطق إضافة الخبر (مدمج للتسهيل) */
        document.addEventListener('DOMContentLoaded', () => {
            const addNewsForm = document.getElementById('add-news-form');
            
            if (addNewsForm) {
                addNewsForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    // 1. جمع البيانات
                    const newNewsId = 'news-' + Date.now();
                    const newNews = {
                        id: newNewsId,
                        title: document.getElementById('news-title').value,
                        category: document.getElementById('news-category').value,
                        author: document.getElementById('news-author').value,
                        imageUrl: document.getElementById('news-image').value,
                        summary: document.getElementById('news-summary').value,
                        content: document.getElementById('news-content').value,
                        date: new Date().toLocaleDateString('ar-YE'), // تاريخ اليوم بتنسيق عربي
                        comments: [] 
                    };
                    
                    // 2. الحفظ في LocalStorage
                    const allNews = window.getStoredData('news', window.newsData || {});
                    allNews[newNewsId] = newNews;
                    window.saveData('news', allNews); 

                    // 3. رسالة النجاح
                    if (typeof showMessageBox === 'function') {
                        showMessageBox('✅ تم نشر الخبر بنجاح!', 'success');
                    } else {
                        alert('تم النشر بنجاح!');
                    }
                    
                    addNewsForm.reset();
                    
                    // خيار للمستخدم: الذهاب لصفحة الأخبار لرؤية النتيجة
                    setTimeout(() => {
                        if(confirm('تم النشر. هل تريد الانتقال لصفحة الأخبار لمعاينته؟')) {
                            window.location.href = 'news.html';
                        }
                    }, 1000);
                });
            }
        });
    </script>
</body>
</html>